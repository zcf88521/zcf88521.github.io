
$(function () {
    var btnLis = $(".tabs li");
    var tabDiv = $(".tab-content div");
    var siftBtn = $(".tabs .sift");
    var seachColse = $(".sift-seach b");
    var seach = $(".sift-seach input")
    var index=0;
    var tabsli_a=$(".tabs li i");


    btnLis.on("click", function () {
        index = $(this).index();
        if(tabsli_a.eq(index).hasClass("upi")){
            tabsli_a.eq(index).removeClass("upi");

        }else{
            for(var i=0;i<tabsli_a.length;i++){
                tabsli_a[i].className="";
            }
            tabsli_a.eq(index).addClass("upi");
        }
        if(index!=3){
            if(siftBtn.hasClass("closexxx")){
                siftBtn.removeClass("closexxx");
            }
        }

        if(index==3){
            if(siftBtn.hasClass("closexxx")){
                siftBtn.removeClass("closexxx");
            }else{
                siftBtn.addClass("closexxx");
            }
        }

        if (tabDiv.eq(index).hasClass("show")) {
            tabDiv.eq(index).removeClass("show");
        } else {
            tabDiv.eq(index).addClass("show").siblings().removeClass("show");
        }


    })
    $(".tabs-3 ul li").on("click",function(){
        var index=$(this).index();
        var sshow=$(".tabs-3 ul s");
        for(var i=0;i<sshow.length;i++){
            sshow.eq(i).removeClass("showS")
        }
        sshow.eq(index).addClass("showS");
    })
    
    //搜索框清空按钮
    seachColse.on("click", function () {
        seach.val("");
        $(this).fadeOut(200);
    })
    //搜索框的事件
    seach.on("keyup", function () {
        if ($(this).val() == "") {
            seachColse.fadeOut(200);
        } else {
            seachColse.fadeIn(200);
        }
    })

    /***************************ajax逻辑区************************/
    var tabs_1 = $(".tabs_1");
    var tabs1_ul = $(".tabs-1 ul");
    var tabsLis = $(".tabs_1 li")
    var tabs_2 = $(".tabs_2");
    var tabs2_ul = $(".tabs-2 ul");
    var tabs_3 = $(".tabs_3");
    var goodsId = 0;
    var cityid = 0;
    var showUl = $(".showUl");
    var ajaxUl=$(".tab-content div");
    var tabsLia=$(".tabs li a span");
    var bodyHeight=0;
    //loadAjax();
    var bodyHeight=loadAjax();
    console.log(bodyHeight);
    /************京东***********/
    responesData("http://139.199.157.195:9090/api/getgsshop", function (data) {
        var tabs1 = template("tabs_1", data);
        tabs1_ul.html("");
        tabs1_ul.append(tabs1);
        var tabs1_lis = $(".tabs-1 ul li");
        var fristshow=$(".tabs-1 ul li:first s");
        fristshow.addClass("showS");
        tabs1_lis.on("click", function () {
            goodsId = $(this).index();
            tabsLia.eq(index).text($(this).text())
            ajaxUl.eq(index).toggleClass("show");
            loadAjax();

            var sshow=$(".tabs-1 ul s");
            for(var i=0;i<sshow.length;i++){
                sshow.eq(i).removeClass("showS")
            }
            sshow.eq(goodsId).addClass("showS");
        })
    })

    /****************地区*****************/
    responesData("http://139.199.157.195:9090/api/getgsshoparea", function (data) {
        var tabs2 = template("tabs_2", data);
        tabs2_ul.html("");
        tabs2_ul.append(tabs2);
        var tabs2_lis = $(".tabs-2 ul li");
        var fristshow=$(".tabs-2 ul li:first s");
        fristshow.addClass("showS");
        tabs2_lis.on("click", function () {
            cityid = $(this).index();
            var str=$(this).text();
            str=str.substring(0,2);
            tabsLia.eq(index).text(str);
            ajaxUl.eq(index).toggleClass("show");
            loadAjax();
            var sshow=$(".tabs-2 ul s");
            for(var i=0;i<sshow.length;i++){
                sshow.eq(i).removeClass("showS")
            }
            sshow.eq(cityid).addClass("showS");
        })
    })



     var dalaylond=$(".dalaylond");
    console.log(dalaylond);
    $.ajax({
        url: "http://139.199.157.195:9090/api/getgsproduct",
        data: {
            shopid: goodsId,
            areaid: cityid
        },
        success: function (siftData) {
            var showGods = template("showGoods", siftData);
            showUl.html("");
            showUl.append(showGods);
             var bodyHt=$("body").height();
            var moveY=bodyHt;
            var clienY=$(window).height();
            var flag=true;
            $(window).scroll(function(e){
                moveY=bodyHt-$(this).scrollTop();
                if((moveY-clienY<200)&&flag){
                    dalaylond[0].style.display="block";
                    var spid=Math.floor(0+Math.random()*(2-0));
                    var aeaid=Math.floor(0+Math.random()*(6-0));

                    //console.log(spid+"======"+aeaid);
                    flag=false;
                    $.ajax({
                        url: "http://139.199.157.195:9090/api/getgsproduct",
                        data: {
                            shopid: spid,
                            areaid: aeaid
                        },
                        success: function (siftData) {
                            dalaylond[0].style.display="none";
                            flag=true;
                            var showGods = template("showGoods", siftData);
                            showUl.append(showGods);
                            console.log(213213213);
                            bodyHt=$("body").height();
                        }
                    })
                }

            })
        }
    })






    /**
     * 1点击商城某一个获取index 区域就默认选择第一个
     * 2渲染页面
     * 1点击区域 先获取点击的商城下标然后在获取点击区域的下标 点击区域的时候需要获取两个值 商城id 区域id
     * 2渲染页面
     */
    function loadAjax() {
        $.ajax({
            url: "http://139.199.157.195:9090/api/getgsproduct",
            data: {
                shopid: goodsId,
                areaid: cityid
            },
            success: function (siftData) {
                var showGods = template("showGoods", siftData);
                showUl.html("");
                showUl.append(showGods);
            }
        })
    }


    function responesData(url, callback) {
        $.ajax({
            url: url,
            dataType: "json",
            success: function (data) {
                callback(data);

            }
        })
    }
})
